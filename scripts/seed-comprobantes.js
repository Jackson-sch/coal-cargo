const { prisma } = require("../src/lib/prisma-cjs"); async function seedComprobantes() { console.log("ðŸ§¾ Creando datos de prueba para comprobantes electrÃ³nicos..."); try { // Limpiar comprobantes existentes primero await prisma.comprobante_detalles.deleteMany({}); await prisma.comprobantes_electronicos.deleteMany({}); console.log("ðŸ—‘ï¸ Comprobantes existentes eliminados"); // Primero verificar si hay clientes y envÃ­os const clientesCount = await prisma.clientes.count(); const enviosCount = await prisma.envios.count(); console.log(`Clientes disponibles: ${clientesCount}`); console.log(`EnvÃ­os disponibles: ${enviosCount}`); if (clientesCount === 0 || enviosCount === 0) { console.log("âš ï¸ No hay clientes o envÃ­os disponibles. Creando datos bÃ¡sicos..."); // Crear un cliente de prueba si no existe if (clientesCount === 0) { await prisma.clientes.create({ data: { id: "cliente-test-001", tipoDocumento: "RUC", numeroDocumento: "20123456789", nombre: "Empresa Test SAC", email: "test@empresa.com", telefono: "987654321", direccion: "Av. Test 123, Lima", activo: true }
        }); console.log("âœ… Cliente de prueba creado"); }
    } // Obtener algunos clientes y envÃ­os para los comprobantes const clientes = await prisma.clientes.findMany({ take: 3 }); const envios = await prisma.envios.findMany({ take: 5 }); // Crear configuraciÃ³n de facturaciÃ³n si no existe const configExistente = await prisma.configuracion_facturacion.findFirst(); if (!configExistente) { await prisma.configuracion_facturacion.create({ data: { ruc: "20123456789", razonSocial: "COAL CARGO SAC", nombreComercial: "Coal Cargo", direccion: "Av. Principal 123, Lima", ubigeo: "150101", pseProvider: "apisunat", pseEnvironment: "development", serieFactura: "F001", serieBoleta: "B001", ultimoNumeroFactura: 0, ultimoNumeroBoleta: 0, porcentajeIgv: 18.00, activo: true }
      }); console.log("âœ… ConfiguraciÃ³n de facturaciÃ³n creada"); }

    // Crear comprobantes de prueba const comprobantesData = [ {
        tipoComprobante: "FACTURA", serie: "F001", numero: 1, numeroCompleto: "F001-00000001", clienteId: clientes[0]?.id, envioId: envios[0]?.id, rucEmisor: "20123456789", razonSocialEmisor: "COAL CARGO SAC", tipoDocumentoCliente: "RUC", numeroDocumentoCliente: "20987654321", nombreCliente: "Cliente Empresa SAC", direccionCliente: "Av. Cliente 456, Lima", subtotal: 100.00, igv: 18.00, total: 118.00, fechaEmision: new Date("2024-01-15"), estado: "ACEPTADO" }, {
        tipoComprobante: "BOLETA", serie: "B001", numero: 1, numeroCompleto: "B001-00000001", clienteId: clientes[1]?.id, envioId: envios[1]?.id, rucEmisor: "20123456789", razonSocialEmisor: "COAL CARGO SAC", tipoDocumentoCliente: "DNI", numeroDocumentoCliente: "12345678", nombreCliente: "Juan PÃ©rez GarcÃ­a", direccionCliente: "Jr. Los Olivos 789, Lima", subtotal: 50.00, igv: 9.00, total: 59.00, fechaEmision: new Date("2024-01-16"), estado: "PENDIENTE" }, {
        tipoComprobante: "FACTURA", serie: "F001", numero: 2, numeroCompleto: "F001-00000002", clienteId: clientes[2]?.id, envioId: envios[2]?.id, rucEmisor: "20123456789", razonSocialEmisor: "COAL CARGO SAC", tipoDocumentoCliente: "RUC", numeroDocumentoCliente: "20111222333", nombreCliente: "Comercial Los Andes EIRL", direccionCliente: "Av. Los Andes 321, Lima", subtotal: 200.00, igv: 36.00, total: 236.00, fechaEmision: new Date("2024-01-17"), estado: "RECHAZADO" }, {
        tipoComprobante: "BOLETA", serie: "B001", numero: 2, numeroCompleto: "B001-00000002", clienteId: clientes[0]?.id, rucEmisor: "20123456789", razonSocialEmisor: "COAL CARGO SAC", tipoDocumentoCliente: "DNI", numeroDocumentoCliente: "87654321", nombreCliente: "MarÃ­a GonzÃ¡lez LÃ³pez", direccionCliente: "Calle Las Flores 654, Lima", subtotal: 75.00, igv: 13.50, total: 88.50, fechaEmision: new Date("2024-01-18"), estado: "ACEPTADO" }, {
        tipoComprobante: "FACTURA", serie: "F001", numero: 3, numeroCompleto: "F001-00000003", clienteId: clientes[1]?.id, rucEmisor: "20123456789", razonSocialEmisor: "COAL CARGO SAC", tipoDocumentoCliente: "RUC", numeroDocumentoCliente: "20444555666", nombreCliente: "Distribuidora Norte SAC", direccionCliente: "Av. Norte 987, Lima", subtotal: 150.00, igv: 27.00, total: 177.00, fechaEmision: new Date("2024-01-19"), estado: "EXCEPCION" }
    ]; // Crear los comprobantes for (const comprobanteData of comprobantesData) { const comprobante = await prisma.comprobantes_electronicos.create({ data: comprobanteData }); // Crear detalles para cada comprobante await prisma.comprobante_detalles.create({ data: { comprobanteId: comprobante.id, orden: 1, descripcion: "Servicio de transporte de carga", unidadMedida: "ZZ", cantidad: 1, precioUnitario: comprobanteData.subtotal, valorVenta: comprobanteData.subtotal, igv: comprobanteData.igv, precioTotal: comprobanteData.total, codigoTipoAfectacion: "10", porcentajeIgv: 18.00 }
      }); }

    console.log(`âœ… ${comprobantesData.length} comprobantes electrÃ³nicos creados con Ã©xito`); // Mostrar resumen const totalComprobantes = await prisma.comprobantes_electronicos.count(); console.log(`ðŸ“Š Total de comprobantes en la base de datos: ${totalComprobantes}`); } catch (error) { console.error("ðŸ’¥ Error al crear comprobantes:", error); throw error; }
} async function main() { console.log("ðŸš€ Ejecutando seed de comprobantes electrÃ³nicos..."); try { await seedComprobantes(); console.log("ðŸŽ‰ Seed de comprobantes completado exitosamente"); } catch (error) { console.error("ðŸ’¥ Error durante el seed:", error); process.exit(1); } finally { await prisma.$disconnect(); }
} main().catch((e) => { console.error("Error no manejado:", e); process.exit(1);
});
