const { prisma } = require("../src/lib/prisma-cjs"); async function seedLogsAuditoria() { try { console.log("üîç Iniciando seed de logs de auditor√≠a..."); // Obtener usuarios existentes const usuarios = await prisma.usuarios.findMany({ where: { deletedAt: null }, take: 3, }); if (usuarios.length === 0) { console.log("‚ö†Ô∏è No hay usuarios disponibles para crear logs"); return; }

    const logsEjemplo = [ // Logs de seguridad {
        accion: "LOGIN_SUCCESS", recurso: "auth", detalles: JSON.stringify({ ip: "192.168.1.100", userAgent: "Mozilla/5.0...", }), categoria: "SEGURIDAD", severidad: "INFO", usuarioId: usuarios[0]?.id, ip: "192.168.1.100", fechaHora: new Date(Date.now() - 1000 * 60 * 30), // 30 minutos atr√°s }, {
        accion: "LOGIN_FAILED", recurso: "auth", detalles: JSON.stringify({ reason: "Invalid password", attempts: 3 }), categoria: "SEGURIDAD", severidad: "WARNING", usuarioId: null, ip: "192.168.1.105", fechaHora: new Date(Date.now() - 1000 * 60 * 45), // 45 minutos atr√°s }, {
        accion: "PASSWORD_CHANGE", recurso: "usuarios", detalles: JSON.stringify({ userId: usuarios[0]?.id }), categoria: "SEGURIDAD", severidad: "INFO", usuarioId: usuarios[0]?.id, ip: "192.168.1.100", fechaHora: new Date(Date.now() - 1000 * 60 * 60 * 2), // 2 horas atr√°s }, // Logs de usuarios {
        accion: "CREATE_USER", recurso: "usuarios", detalles: JSON.stringify({ newUserId: usuarios[1]?.id, role: "OPERADOR", }), categoria: "USUARIOS", severidad: "INFO", usuarioId: usuarios[0]?.id, ip: "192.168.1.100", fechaHora: new Date(Date.now() - 1000 * 60 * 60 * 4), // 4 horas atr√°s }, {
        accion: "UPDATE_USER", recurso: "usuarios", detalles: JSON.stringify({ updatedUserId: usuarios[1]?.id, changes: ["role", "sucursalId"], }), categoria: "USUARIOS", severidad: "INFO", usuarioId: usuarios[0]?.id, ip: "192.168.1.100", fechaHora: new Date(Date.now() - 1000 * 60 * 60 * 6), // 6 horas atr√°s }, // Logs de env√≠os {
        accion: "CREATE_ENVIO", recurso: "envios", detalles: JSON.stringify({ guia: "ENV-2024-001", clienteId: "cliente123", }), categoria: "ENVIOS", severidad: "INFO", usuarioId: usuarios[1]?.id, ip: "192.168.1.101", fechaHora: new Date(Date.now() - 1000 * 60 * 60 * 8), // 8 horas atr√°s }, {
        accion: "UPDATE_ENVIO_STATUS", recurso: "envios", detalles: JSON.stringify({ guia: "ENV-2024-001", oldStatus: "REGISTRADO", newStatus: "EN_TRANSITO", }), categoria: "ENVIOS", severidad: "INFO", usuarioId: usuarios[1]?.id, ip: "192.168.1.101", fechaHora: new Date(Date.now() - 1000 * 60 * 60 * 10), // 10 horas atr√°s }, // Logs de sistema {
        accion: "SYSTEM_STARTUP", recurso: "sistema", detalles: JSON.stringify({ version: "1.0.0", environment: "production", }), categoria: "SISTEMA", severidad: "INFO", usuarioId: null, ip: null, fechaHora: new Date(Date.now() - 1000 * 60 * 60 * 24), // 24 horas atr√°s }, {
        accion: "DATABASE_BACKUP", recurso: "sistema", detalles: JSON.stringify({ size: "125MB", duration: "45s" }), categoria: "BACKUP", severidad: "INFO", usuarioId: null, ip: null, fechaHora: new Date(Date.now() - 1000 * 60 * 60 * 12), // 12 horas atr√°s }, // Logs de configuraci√≥n {
        accion: "UPDATE_CONFIG", recurso: "configuracion", detalles: JSON.stringify({ section: "general", changes: ["empresa_nombre", "empresa_telefono"], }), categoria: "CONFIGURACION", severidad: "INFO", usuarioId: usuarios[0]?.id, ip: "192.168.1.100", fechaHora: new Date(Date.now() - 1000 * 60 * 60 * 3), // 3 horas atr√°s }, // Logs de facturaci√≥n {
        accion: "GENERATE_INVOICE", recurso: "facturacion", detalles: JSON.stringify({ invoiceNumber: "F001-00000001", amount: 118.0, }), categoria: "FACTURACION", severidad: "INFO", usuarioId: usuarios[1]?.id, ip: "192.168.1.101", fechaHora: new Date(Date.now() - 1000 * 60 * 60 * 5), // 5 horas atr√°s }, // Logs de error {
        accion: "DATABASE_ERROR", recurso: "sistema", detalles: JSON.stringify({ error: "Connection timeout", query: "SELECT * FROM envios", }), categoria: "SISTEMA", severidad: "ERROR", usuarioId: null, ip: null, fechaHora: new Date(Date.now() - 1000 * 60 * 60 * 1), // 1 hora atr√°s }, // Logs cr√≠ticos {
        accion: "SECURITY_BREACH_ATTEMPT", recurso: "seguridad", detalles: JSON.stringify({ ip: "192.168.1.999", attempts: 50, blocked: true, }), categoria: "SEGURIDAD", severidad: "CRITICAL", usuarioId: null, ip: "192.168.1.999", fechaHora: new Date(Date.now() - 1000 * 60 * 60 * 7), // 7 horas atr√°s }, // M√°s logs recientes {
        accion: "VIEW_DASHBOARD", recurso: "dashboard", detalles: JSON.stringify({ section: "main" }), categoria: "SISTEMA", severidad: "INFO", usuarioId: usuarios[0]?.id, ip: "192.168.1.100", fechaHora: new Date(Date.now() - 1000 * 60 * 5), // 5 minutos atr√°s }, {
        accion: "EXPORT_REPORT", recurso: "reportes", detalles: JSON.stringify({ reportType: "envios", format: "PDF" }), categoria: "AUDITORIA", severidad: "INFO", usuarioId: usuarios[0]?.id, ip: "192.168.1.100", fechaHora: new Date(Date.now() - 1000 * 60 * 15), // 15 minutos atr√°s }, ]; // Crear logs for (const logData of logsEjemplo) { try { const log = await prisma.logs_auditoria.create({ data: { id: `log_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`, ...logData, }, }); console.log(`‚úÖ Log creado: ${log.accion} - ${log.categoria}`); } catch (error) { console.error( `‚ùå Error al crear log ${logData.accion}:`, error.message ); }
    } // Mostrar estad√≠sticas const totalLogs = await prisma.logs_auditoria.count(); const logsPorCategoria = await prisma.logs_auditoria.groupBy({ by: ["categoria"], _count: { categoria: true }, }); console.log("\nüìä ESTAD√çSTICAS DE LOGS:"); console.log(` üìù Total de logs: ${totalLogs}`); console.log(" üìã Por categor√≠a:"); logsPorCategoria.forEach((grupo) => { console.log(` ${grupo.categoria}: ${grupo._count.categoria} logs`); }); console.log("\nüéâ Seed de logs de auditor√≠a completado"); } catch (error) { console.error("‚ùå Error en seed de logs de auditor√≠a:", error); } finally { await prisma.$disconnect(); }
} // Ejecutar si se llama directamente if (require.main === module) { seedLogsAuditoria(); }

module.exports = { seedLogsAuditoria };
